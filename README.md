# scenic-ins-analysis

A Python project to accompany the paper 
"Speed versus Accuracy Emphasis Inverts Effects of Stimulus Class on 2AFC Recognition"
by [M. B. Moreland](https://github.com/moreland-hood) 
and [J. M. Dusel](https://johnmdusel.github.io/).

This repository provides:

1. **Bayesian data analysis** for empirical aggregated response accuracy data using [PyMC](https://pymc.io). 
Our analyses are inspired by similar analyses from 
[*Doing Bayesian Data Analysis, 2ed* by J. Kruschke](https://sites.google.com/site/doingbayesiandataanalysis/).

2. **Bayesian diffusion modeling** using [HSSM](https://lnccbrown.github.io/HSSM/).

Our priors are based on data from a previous related study 
["Response Time and Encoding Strength: Moderating the Choice Similarity Effect"](https;//foo.bar)
by M. B. Moreland and S. E. Clark (2025).

This repository is adapted to the datasets for the experiment reported in our paper.
Fpr example, our methods for computing experimental effects could be re-used in another context, 
but you would need to clean out hardcoded assumptions about our data.

## 1. Using this repository

Be sure that Docker is installed on your system.
Open the root directory of this project in a terminal session.
 
### 1.1 Build the Docker image

The first step creates a file named `.env` that contains your user ID and group ID. 
Docker will read this file while building the image and set up a user having your user ID and group ID.
That way, the output files generated by the analysis will be owned by your account, not `root`.

```
echo -e "USERNAME=$USER\nUSER_UID=$(id -u $USER)\nGROUPNAME=$(id -gn $USER | sed 's/ /_/g')\nGROUP_GID=$(id -g $USER)" > .env
```

The second step is to build the image. 

```
docker build -t "scenic-ins" .
```


### 1.2 Run the analyses

Run the analyses from a terminal session inside the root directory of this project.
By default, both analysis will run 16 MCMC chains for 1,000 burn-in steps followed by 2,000 draws.
The MCMC sampler will attempt to assign one chain per core.
See below for advice on changing these settings.
   
#### 1.2.1 Empirical proportion correct/response time analyses
 
Takes about 4 minutes on DELL XPS 15 9500 (Intel Core i7-10875H CPU @ 2.30GHz x 16, 64.0 GB memory). 
Takes 128 seconds on DELL Precision 7920 (Intel Xeon Gold 6138 CPU @ 2.00GHz x 80, 125.5 GB memory).

```
./scripts/run_empirical_data_analysis.sh
```

#### 1.2.2 Diffusion modeling

Takes about 11 hours on DELL Precision 7920 (ntel Xeon Gold 6138 CPU @ 2.00GHz x 80, 125.5 GB memory).

```
./scripts/run_diffusion_modeling.sh
```


### 1.3 Inspect the output files in `analysis_results/`

| File                                | Created By                                                                     | Description                                                                      |
|-------------------------------------|--------------------------------------------------------------------------------|----------------------------------------------------------------------------------|
| `credibility_pc.csv`                | `PcAnalysis.pc_credibility_analysis`                                           | Posterior credibility check for p(c)                                             |
| `credibility_rt*`                   | `RtAnalysis.credibility_analysis`                                              | Posterior credibility check  RT                                                  |
| `hssm_prior_stdev-deflections*`     | `prior.get_hssm_prior`                                                         | PDF or PPF plot of prior distribution on STDEV of deflections                    |
| `mcmc_summary_hssm.csv`             | `HSSMAnalysis.run_mcmc`                                                        | MCMC diagnostics for diffusion modeling                                          |
| `mcmc_summary_pc*.csv`              | `PcAnalysis.run_mcmc`                                                          | MCMC diagnostics for empirical/predicted p(c)                                    |
| `posterior_effects_hssm.csv`        | `HSSMAnalysis.analyze_posterior`                                               | Experimental effects on diffusion model parameters                               |
| `posterior_effects_pc*.csv`         | `PcAnalysis.analyze_posterior`                                                 | Experimental effects empirical/predicted p(c)                                    |
| `posterior_summary_hssm.csv`        | `HSSMAnalysis.analyze_posterior`                                               | Summary of posterior distribution on diffusion model parameters                  |
| `posterior_summary_pc*.csv`         | `PcAnalysis.analyze_posterior`                                                 | Summary of posterior distribution on GLM parameters for empirical/predicted p(c) |
| `p(c)_hist*`                        | `PcAnalysis.credibility_analysis`                                              | Crude histogram to accompany credibility_pc.csv                                  |
| `prior_*.png`                       | `prior.plot_informative_prior` from `PcAnalysis` or `HssmAnalysis`             | Plot of prior distributions on intercept and deflections                         |
| `response_proportion_rt_quantiles*` | `RtAnalysis.{get_response_proportion_rt_quantiles, quantile_probability_plot}` | Quantile-probability plot for empirical RT                                       |
| `rt_effects*.png`                   | `RtAnalysis.{effects_plot_empirical, effects_plot_postpred}`                   | Experimental effects on empirical/predicted RT                                   |
| `rt_quantiles_hssm.csv`             | `RtAnalysis.process_posterior_predictions`                                     | Predicted RT quantiles                                                           |
| `ScenicInsAggregated-HSSM.csv`      | `PosteriorAnalysis.process_posterior_predictions`                              | Predicted RT/response data                                                       |
| `trace*.png`                        | `PcAnalysis.run_mcmc`                                                          | MCMC diagnostic plots for GLM of p(c) or empirical p(c)                          |


## 2. Inspecting the code

This project is organized into separate analysis for proportion correct, response time, diffusion 
modeling, and posterior predictive checks.
We recommend first reading the scripts `src/run_empirical_data_analysis.py` or `src/run_diffusion_modeling.py` 
to learn the high-level steps. 
Important classes and methods have docstrings that describe their inputs, outputs, and purpose.

### 2.1 The `config.yaml` file

This is where paths and file names are hardcoded. 
The default values are adequate to reproduce our results. 
To experiment with different parameter settings consider modifying the `'savedir'` entry.


### 2.2 Changing parameter settings

Parameter settings have to be changed in the Python scripts themselves. 
For example, to change the number of MCMC chains or the length of an MCMC chain, 
look at the `McmcAnalysis` class defined in `src/analysis.py`. 